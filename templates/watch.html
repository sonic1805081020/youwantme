{% extends "base.html" %}

{% block title %}{{ video[3] }} - Partage de Vid√©os{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8">
        <div class="ratio ratio-16x9 mb-3">
            <video controls class="rounded" preload="metadata" style="background: #000;" id="mainVideo">
                <source src="{{ url_for('serve_video', filename=video[1]) }}" type="video/mp4">
                <source src="{{ url_for('serve_video', filename=video[1]) }}" type="video/webm">
                <source src="{{ url_for('serve_video', filename=video[1]) }}" type="video/ogg">
                Votre navigateur ne supporte pas la lecture de vid√©os.
            </video>
            
            <!-- Indicateur de chargement -->
            <div id="loadingIndicator" class="position-absolute top-50 start-50 translate-middle text-white d-none">
                <div class="spinner-border" role="status">
                    <span class="visually-hidden">Chargement...</span>
                </div>
                <div class="mt-2">Chargement de la vid√©o...</div>
            </div>
        </div>
        
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const video = document.getElementById('mainVideo');
                const loader = document.getElementById('loadingIndicator');
                
                // Afficher le loader pendant le chargement
                video.addEventListener('loadstart', function() {
                    loader.classList.remove('d-none');
                });
                
                video.addEventListener('canplay', function() {
                    loader.classList.add('d-none');
                });
                
                video.addEventListener('error', function() {
                    loader.classList.add('d-none');
                    console.error('Erreur de chargement vid√©o');
                });
                
                // Pr√©charger les m√©tadonn√©es au chargement de la page
                video.load();
            });
        </script>
    </div>
    <div class="col-lg-4">
        <div class="card">
            <div class="card-body">
                <h4 class="card-title">{{ video[3] }}</h4>
                
                <div class="mb-3">
                    <small class="text-muted">
                        {% if video[5] and video[5] > 0 %}
                            <strong>Dur√©e :</strong> 
                            {{ "%.0f"|format(video[5] // 60) }}:{{ "%02.0f"|format(video[5] % 60) }}
                        {% endif %}
                    </small><br>
                    <small class="text-muted">
                        <strong>Upload√© le :</strong> {{ video[6] }}
                    </small>
                </div>

                {% if video[4] %}
                <div class="mb-3">
                    <h6>Description :</h6>
                    <p class="card-text">{{ video[4] }}</p>
                </div>
                {% endif %}

                <div class="d-grid gap-2">
                    <a href="{{ url_for('index') }}" class="btn btn-outline-primary">
                        ‚¨ÖÔ∏è Retour aux vid√©os
                    </a>
                    <a href="{{ url_for('download_video', video_id=video[0]) }}" 
                       class="btn btn-success">
                       ‚¨áÔ∏è T√©l√©charger cette vid√©o
                    </a>
                    <a href="{{ url_for('delete_video', video_id=video[0]) }}" 
                       class="btn btn-outline-danger"
                       onclick="return confirm('√ätes-vous s√ªr de vouloir supprimer cette vid√©o ?')">
                       üóëÔ∏è Supprimer cette vid√©o
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %>